<html>

<body>
    <form action="/" method="post" enctype="multipart/form-data">
        <input type="file" id="fileinput">
    </form>
    <section>
        <video controls="" width="320" height="240"></video>
    </section>
    <script type="text/javascript">

    var video = document.querySelector('video');

    window.MediaSource = window.MediaSource || window.WebKitMediaSource;
    if (!!!window.MediaSource) {
        alert('MediaSource API is not available');
    }

    var mediaSource = new MediaSource();

    video.src = window.URL.createObjectURL(mediaSource);

    var theFileInput = document.getElementById('fileinput');

    theFileInput.addEventListener('change', function(e) {

        var file = theFileInput.files[0];
        var reader = new FileReader();

        console.log(file);
        console.log("file size:", Math.round(file.size / 1000) / 1000, "MB");

        reader.readAsArrayBuffer(file);

        reader.onloadend = function() {
            console.log("reading file finished");
            var sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs="vorbis,vp8"');
            sourceBuffer.addEventListener('updateend', function(_) {
                mediaSource.endOfStream();
                video.play();
            });
            sourceBuffer.appendBuffer(new Uint8Array(reader.result));
        };

    });


    </script>
</body>

</html>